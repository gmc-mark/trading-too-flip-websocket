# This workflow will build a Java project with Maven, and cache/restore any dependencies to improve the workflow execution time
# For more information see: https://help.github.com/actions/language-and-framework-guides/building-and-testing-java-with-maven

name: Java CI with Maven

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Set up JDK 11
      uses: actions/setup-java@v2
      with:
        java-version: '11'
        distribution: 'adopt'
        cache: maven
    - name: Build with Maven
      run: mvn -B package --file pom.xml
      # 디렉토리 생성
    - name: Make Directory
      run: mkdir -p deploy

      # Jar 파일 복사
    - name: Copy Jar
      run: cp ./build/libs/*.war ./deploy

      # 파일 압축
    - name: Make zip file
      run: zip -r ./springboor-with-githubaction.zip ./deploy

    - name: Upload S3
      # You may pin to the exact commit or the version.
      # uses: shallwefootball/upload-s3-action@bcd7c2408245fd6cd19b5512a473b1a7a8b48a35
      uses: shallwefootball/upload-s3-action@v1.1.3
      with:
        # aws key id
        aws_key_id: ${{ secrets.ACCESS_KEY }}
        # aws secret access key
        aws_secret_access_key: ${{ secrets.SECRET_KEY }}
        # aws bucket name
        aws_bucket: kr.object.fin-ncloudstorage.com
        # directory to upload
        source_dir: ./deploy
        # destination directory for upload
        destination_dir: /
